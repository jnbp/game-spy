<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wer ist der Spion? - Setup</title>
    <!-- Favicon (Same as before) -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;stroke:%23333;stroke-width:2px;stroke-linejoin:round;%7D%3C/style%3E%3C/defs%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_1-2' data-name='Layer 1'%3E%3Cpath class='cls-1' d='M84.8,34.57c-1.42-3.53-3.36-6.68-5.76-9.37a29.42,29.42,0,0,0-9.41-6.38,12.11,12.11,0,0,1-6.5-4.57C59.86,9.32,55.81,5,50,5s-9.86,4.32-13.13,9.25a12.11,12.11,0,0,1-6.5,4.57,29.42,29.42,0,0,0-9.41,6.38c-2.4,2.69-4.34,5.84-5.76,9.37a16.79,16.79,0,0,0-1,5.48c0,13.63,11.64,26.24,21.11,34.69.57.5,1.16,1,1.77,1.46a44.7,44.7,0,0,0,12.91,6.23V95h10V82.43A44.7,44.7,0,0,0,62.9,76.2c.61-.47,1.2-1,1.77-1.46,9.47-8.45,21.11-21.06,21.11-34.69A16.79,16.79,0,0,0,84.8,34.57ZM31.5,50.05a10,10,0,1,1,10-10A10,10,0,0,1,31.5,50.05Zm37,0a10,10,0,1,1,10-10A10,10,0,0,1,68.5,50.05Z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E">
    <style>
        /* Styles (mostly same as before) */
        @import url('https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;700&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 16px; }
        body {
            font-family: 'Jost', sans-serif;
            background: linear-gradient(135deg, #3949ab, #7b1fa2); color: #FFFFFF;
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            padding: 15px; overflow-x: hidden;
        }
        .container {
            background: rgba(255, 255, 255, 0.1); padding: 25px 20px; border-radius: 15px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.18);
            width: 100%; max-width: 450px; text-align: center; transition: all 0.3s ease-in-out;
        }
        .screen { display: none; animation: fadeIn 0.5s ease-in-out; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 25px; line-height: 1.2; }
        h2 { font-size: 1.4rem; font-weight: 500; margin-bottom: 15px; margin-top: 25px; }
        p { font-size: 1rem; line-height: 1.6; margin-bottom: 15px; }
        label { display: block; font-weight: 500; margin-bottom: 8px; font-size: 1rem; text-align: left; }
        .input-section { margin-bottom: 20px; }
        .input-group { display: flex; align-items: center; margin-bottom: 5px; background-color: rgba(255, 255, 255, 0.2); border-radius: 8px; padding: 5px; }
        .input-group button { background-color: rgba(255, 255, 255, 0.3); color: #FFFFFF; border: none; width: 40px; height: 40px; font-size: 1.5rem; font-weight: bold; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease; flex-shrink: 0; }
        .input-group button:hover { background-color: rgba(255, 255, 255, 0.5); }
        .input-group button:active { background-color: rgba(255, 255, 255, 0.7); }
        input[type="number"] { flex-grow: 1; height: 40px; padding: 0 10px; border: none; background: transparent; color: #FFFFFF; font-family: 'Jost', sans-serif; font-size: 1.2rem; text-align: center; font-weight: 500; -moz-appearance: textfield; appearance: textfield; }
        input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .location-packs-container { max-height: 180px; overflow-y: auto; background: rgba(0, 0, 0, 0.1); border-radius: 8px; padding: 10px 15px; margin-bottom: 15px; text-align: left; border: 1px solid rgba(255, 255, 255, 0.1); }
        .location-packs-container::-webkit-scrollbar { width: 6px; }
        .location-packs-container::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 3px; }
        .location-packs-container::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 3px; }
        .location-packs-container::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }
        .pack-option { display: flex; align-items: center; margin-bottom: 12px; cursor: pointer; padding: 5px 0; }
        .pack-option input[type="checkbox"] { margin-right: 10px; width: 20px; height: 20px; cursor: pointer; accent-color: #7b1fa2; }
        .pack-option label { font-weight: 400; margin-bottom: 0; flex-grow: 1; cursor: pointer; }
        .pack-selection-buttons { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .pack-selection-buttons button { background: none; border: 1px solid rgba(255, 255, 255, 0.5); color: #FFFFFF; padding: 8px 12px; font-size: 0.85rem; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease; }
        .pack-selection-buttons button:hover { background-color: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.8); }
        .btn { display: inline-block; width: 100%; padding: 15px 20px; font-size: 1.1rem; font-weight: 500; color: #7b1fa2; background-color: #FFFFFF; border: none; border-radius: 8px; cursor: pointer; text-align: center; text-decoration: none; transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.3s ease; margin-top: 20px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); }
        .btn:hover { background-color: #f0f0f0; }
        .btn:active { transform: scale(0.98); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        .btn:disabled { background-color: #cccccc; color: #888888; cursor: not-allowed; box-shadow: none; transform: none; opacity: 0.7; }
        .error-message { color: #ffcdd2; font-size: 0.9rem; margin-top: 5px; margin-bottom: 10px; min-height: 1.2em; text-align: left; font-weight: 500; display: none; }
        .error-message.visible { display: block; }
        #assignmentScreen h2, #completeScreen h2 { margin-top: 0; margin-bottom: 15px; }
        .icon-display { font-size: 3rem; width: 3em; height: 3em; margin: 15px auto 20px auto; display: flex; justify-content: center; align-items: center; }
        .icon-display svg { width: 100%; height: 100%; fill: #FFFFFF; }

        /* Role display adjustments */
        #locationImage { display: none; } /* Hide the img tag always */

        #roleEmoji {
            font-size: 4rem; /* Larger emoji */
            line-height: 1.2;
            display: block; /* Ensure it takes its own line */
            margin: 10px auto 15px auto; /* Spacing */
            text-align: center;
        }

        #roleTextContainer { margin-top: 0; } /* Remove top margin as emoji provides space */
        #roleText {
            font-size: 1.2rem; font-weight: 400; background-color: rgba(0, 0, 0, 0.2); padding: 15px;
            border-radius: 8px; min-height: auto; /* Allow height to adjust */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            word-break: break-word; text-align: center;
        }
         #roleText .role-label { /* Style for "Du bist am Ort:" */
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 5px;
         }
        #roleText strong { /* Style for location name / "Spion!" */
            font-weight: 700; color: #f0f0f0; font-size: 1.4rem; /* Larger location name */
         }

        /* General Utility */
        .hidden { display: none !important; }
        #handoverIconSVG, #roleIconSVG { display: none; }
    </style>
</head>
<body>
    <!-- SVG Icon Definitions (Role/Handover - unchanged) -->
    <svg id="handoverIconSVG" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16.75 2H7.25C6.01 2 5 3.01 5 4.25v15.5C5 20.99 6.01 22 7.25 22h9.5c1.24 0 2.25-1.01 2.25-2.25V4.25C19 3.01 17.99 2 16.75 2zM12 20c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm4.5-3h-9V4h9v13zM14 17h3l-4-4v3zM7 7h3l-4 4V8z"/><path d="M0 0h24v24H0z" fill="none"/></svg>
    <svg id="roleIconSVG" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/><path d="M0 0h24v24H0z" fill="none"/></svg>

    <div class="container">
         <!-- Screens (HTML structure mostly the same) -->
        <div id="setupScreen" class="screen active">
            <h1>Wer ist der Spion? - Einrichtung</h1>
            <div class="input-section">
                <label for="playerCountInput">Anzahl Spieler:</label>
                <div class="input-group"> <button id="decrementPlayer">-</button> <input type="number" id="playerCountInput" min="3" value="3"> <button id="incrementPlayer">+</button> </div>
                <p id="playerCountError" class="error-message"></p>
            </div>
             <div class="input-section">
                <label for="spyCountInput">Anzahl Spione:</label>
                <div class="input-group"> <button id="decrementSpy">-</button> <input type="number" id="spyCountInput" min="1" value="1"> <button id="incrementSpy">+</button> </div>
                <p id="spyCountError" class="error-message"></p>
            </div>
            <h2>Orte-Pakete ausw√§hlen:</h2>
            <div class="pack-selection-buttons"> <button id="selectAllPacks">Alle ausw√§hlen</button> <button id="deselectAllPacks">Alle abw√§hlen</button> </div>
            <div id="locationPacksContainer" class="location-packs-container"></div>
            <p id="packSelectionError" class="error-message"></p>
            <button id="startGameButton" class="btn" disabled>Spiel starten</button>
        </div>
        <div id="assignmentScreen" class="screen">
            <div id="readyPlayerState">
                <h2 id="readyPlayerHeading">Bereit f√ºr Spieler X?</h2> <div class="icon-display" id="handoverIconContainer"></div> <p>Gib das Handy an <strong id="readyPlayerNumber">Spieler X</strong>.</p> <p style="font-size: 0.9rem;">Schaue nur auf das Display, wenn du an der Reihe bist!</p> <button id="showRoleButton" class="btn">Rolle anzeigen</button>
            </div>
            <div id="showRoleState" class="hidden">
                <h2 id="rolePlayerHeading">Rolle f√ºr Spieler X</h2>
                <div class="icon-display" id="roleIconContainer"></div>
                <!-- Emoji Display Area -->
                <span id="roleEmoji"></span>
                <!-- Location Image is now hidden via CSS -->
                <img id="locationImage" src="" alt="">
                <div id="roleTextContainer"> <p id="roleText"></p> </div>
                <button id="hideRoleButton" class="btn">Verstanden & Weitergeben</button>
            </div>
        </div>
        <div id="completeScreen" class="screen">
            <h2>Setup abgeschlossen!</h2> <p>Alle Spieler kennen ihre Rolle.</p> <p>Das Spiel kann beginnen! Stellt Fragen, um die Spione zu finden oder den Ort zu erraten.</p> <button id="newGameButton" class="btn">Neues Spiel starten</button>
        </div>
    </div>

    <script>
        // --- Location Data (Now includes 'emoji') ---
        const locationData = {
            'standard': { name: 'Standard Orte', locations: [
                { name: 'Strand', emoji: 'üèñÔ∏è' }, { name: 'Casino', emoji: 'üé∞' }, { name: 'Zirkus', emoji: 'üé™' },
                { name: 'Krankenhaus', emoji: 'üè•' }, { name: 'Filmstudio', emoji: 'üé¨' }, { name: 'Supermarkt', emoji: 'üõí' },
                { name: 'Theater', emoji: 'üé≠' }, { name: 'Polizeistation', emoji: 'üöì' }, { name: 'Schule', emoji: 'üè´' },
                { name: 'Restaurant', emoji: 'üçΩÔ∏è' }, { name: 'Hotel', emoji: 'üè®' }, { name: 'Bank', emoji: 'üè¶' },
                { name: 'Botschaft', emoji: 'üèõÔ∏è' }, { name: 'Firmenfeier', emoji: 'üéâ' }, { name: 'Kathedrale', emoji: '‚õ™' },
                { name: 'Milit√§rbasis', emoji: 'üéñÔ∏è' }, { name: 'Universit√§t', emoji: 'üéì' }, { name: 'Werkstatt', emoji: 'üõ†Ô∏è' },
                { name: 'Wellness-Tempel', emoji: 'üßñ‚Äç‚ôÄÔ∏è' }, { name: 'Raumstation', emoji: 'üõ∞Ô∏è' }, { name: 'U-Boot', emoji: 'üö§' }, // No perfect sub emoji
                { name: 'Weinberg', emoji: 'üçá' }, { name: 'Autorennen', emoji: 'üèéÔ∏è' }, { name: 'Kreuzfahrtschiff', emoji: 'üõ≥Ô∏è' },
                { name: 'Museum', emoji: 'üèõÔ∏è' }, { name: 'Freizeitpark', emoji: 'üé¢' }, { name: 'Baustelle', emoji: 'üèóÔ∏è' },
                { name: 'Campingplatz', emoji: 'üèïÔ∏è' }, { name: 'Tankstelle', emoji: '‚õΩ' }, { name: 'Gef√§ngnis', emoji: '‚õìÔ∏è' },
                { name: 'Hochzeit', emoji: 'üíí' }, { name: 'Bibliothek', emoji: 'üìö' }, { name: 'Kunstgalerie', emoji: 'üñºÔ∏è' },
                { name: 'Bauernhof', emoji: 'üßë‚Äçüåæ' }, { name: 'Fitnessstudio', emoji: 'üí™' }, { name: 'Gerichtsgeb√§ude', emoji: '‚öñÔ∏è' },
                { name: 'Nachtclub', emoji: 'üï∫' }, { name: 'Opernhaus', emoji: 'üé§' }, { name: 'Parlament', emoji: 'üèõÔ∏è' },
                { name: 'Postamt', emoji: 'üìÆ' }, { name: 'Radiosender', emoji: 'üìª' }, { name: 'Schrottplatz', emoji: 'üî©' },
                { name: 'Stadion', emoji: 'üèüÔ∏è' }, { name: 'Weinprobe', emoji: 'üç∑' }, { name: 'Zoo', emoji: 'üêí' },
                { name: 'Bergwerk', emoji: '‚õèÔ∏è' }, { name: 'Fabrik', emoji: 'üè≠' }, { name: 'Leuchtturm', emoji: 'üí°' },
                { name: 'Markt', emoji: 'üçé' }, { name: 'Schloss', emoji: 'üè∞' }
            ]},
            'fantasy': { name: 'Fantasy Orte', locations: [
                { name: 'Drachenh√∂hle', emoji: 'üêâ' }, { name: 'Zauberschule', emoji: 'ü™Ñüè´' }, { name: 'Elfenwald', emoji: 'üå≥‚ú®' },
                { name: 'Zwergenmine', emoji: '‚õèÔ∏èüíé' }, { name: 'Spukschloss', emoji: 'üëªüè∞' }, { name: 'Oger-Sumpf', emoji: 'üê∏üëπ' },
                { name: 'Goblindorf', emoji: 'üë∫üèòÔ∏è' }, { name: 'Magischer Turm', emoji: 'ü™Ñüóº' }, { name: 'Unterwasserreich', emoji: 'üßú‚Äç‚ôÄÔ∏èüåä' },
                { name: 'Himmelsstadt', emoji: '‚òÅÔ∏èüèôÔ∏è' }, { name: 'Feenlichtung', emoji: 'üßö‚Äç‚ôÄÔ∏è‚ú®' }, { name: 'Greifenhorst', emoji: 'ü¶ÖüèûÔ∏è' },
                { name: 'Ork-Festung', emoji: 'üëπüè∞' }, { name: 'Schattenreich', emoji: 'üíÄ‚ö´Ô∏è' }, { name: 'Kristallh√∂hlen', emoji: 'üíéüèûÔ∏è' },
                { name: 'Verfluchter Wald', emoji: 'üå≥üëª' }, { name: 'Heiliger Hain', emoji: 'üå≥üôè' }, { name: 'Riesen-Schmiede', emoji: 'üî®üî•' },
                { name: 'Nomadenzeltlager', emoji: '‚õ∫Ô∏èüî•' }, { name: 'Piratenbucht (Fantasy)', emoji: 'üè¥‚Äç‚ò†Ô∏èüèùÔ∏è' }, { name: 'Tempel der Elemente', emoji: '‚öõÔ∏èüèõÔ∏è' },
                { name: 'Sphinx-Oase', emoji: 'ü¶ÅüèúÔ∏è' }, { name: 'Unterirdische Stadt', emoji: 'üèòÔ∏èüöá' }, { name: 'Wolkenpalast', emoji: '‚òÅÔ∏èüè∞' },
                { name: 'Zeitreiseportal', emoji: '‚è≥üåÄ' }, { name: 'Alchemistenlabor', emoji: 'üß™üî¨' }, { name: 'Arena der Champions', emoji: '‚öîÔ∏èüèüÔ∏è' },
                { name: 'Dschinn-Flasche', emoji: 'üßû‚Äç‚ôÇÔ∏èüè∫' }, { name: 'Friedhof der K√∂nige', emoji: 'üëëü™¶' }, { name: 'Garten der Nymphen', emoji: 'üßö‚Äç‚ôÄÔ∏è‚õ≤' },
                { name: 'Handelsstadt in der W√ºste', emoji: 'üèúÔ∏èüê™' }, { name: 'Hexenzirkel', emoji: 'üßô‚Äç‚ôÄÔ∏è‚≠ï' }, { name: 'Insel der Sirenen', emoji: 'üßú‚Äç‚ôÄÔ∏èüèùÔ∏è' },
                { name: 'J√§gerlager im Schnee', emoji: 'üèπ‚ùÑÔ∏è' }, { name: 'Kloster der M√∂nche', emoji: 'üßò‚Äç‚ôÇÔ∏è‚õ©Ô∏è' }, { name: 'Lavastr√∂me', emoji: 'üåãüî•' },
                { name: 'Luftschiffhafen', emoji: 'üéà‚öì' }, { name: 'Magische Bibliothek', emoji: 'üìö‚ú®' }, { name: 'Nebelgebirge', emoji: '‚õ∞Ô∏èüå´Ô∏è' },
                { name: 'Portal in eine andere Dimension', emoji: 'üåÄüåå' }, { name: 'Ruinen einer alten Zivilisation', emoji: 'üèõÔ∏èüíî' }, { name: 'Schwebende Inseln', emoji: '‚òÅÔ∏èüèùÔ∏è' },
                { name: 'Sumpf der Hydras', emoji: 'üêçüê∏' }, { name: 'Tal der Einh√∂rner', emoji: 'ü¶ÑüèûÔ∏è' }, { name: 'Verbotene Zone', emoji: 'üö´‚ò¢Ô∏è' },
                { name: 'Vulkaninsel', emoji: 'üåãüèùÔ∏è' }, { name: 'Wald der sprechenden Tiere', emoji: 'üó£Ô∏èüå≥' }, { name: 'Wunschbrunnen', emoji: '‚õ≤Ô∏èü™ô' },
                { name: 'Zentaurensteppe', emoji: 'üêéüèπ' }, { name: 'Zyklopeninsel', emoji: 'üëÅÔ∏èüèùÔ∏è' }
            ]},
            'scifi': { name: 'Sci-Fi Orte', locations: [
                { name: 'Raumstation', emoji: 'üõ∞Ô∏è' }, { name: 'Mars-Kolonie', emoji: 'ü™êüèòÔ∏è' }, { name: 'Alien-Raumschiff', emoji: 'üëΩüõ∏' },
                { name: 'Zeitmaschine', emoji: '‚è≥‚öôÔ∏è' }, { name: 'Postapokalyptische Stadt', emoji: 'üèôÔ∏èüî•' }, { name: 'Kybernetik-Labor', emoji: 'ü§ñüî¨' },
                { name: 'Mondbasis', emoji: 'üåïüèòÔ∏è' }, { name: 'Androidenfabrik', emoji: 'ü§ñüè≠' }, { name: 'Asteroidenfeld', emoji: '‚òÑÔ∏èüåå' },
                { name: 'Wurmloch-Generator', emoji: 'üåÄ‚öôÔ∏è' }, { name: 'Generationenschiff', emoji: 'üöÄüëµ' }, { name: 'Terraformierte Welt', emoji: 'üåçüå±' },
                { name: 'Unterwasser-Metropole', emoji: 'üåäüèôÔ∏è' }, { name: 'Virtuelle Realit√§t Hub', emoji: 'üï∂Ô∏èüåê' }, { name: 'Gef√§ngniskolonie auf Pluto', emoji: 'ü•∂‚õìÔ∏è' },
                { name: 'Handelsraumhafen', emoji: 'üõ∞Ô∏èüõí' }, { name: 'Experimentelles FTL-Schiff', emoji: 'üöÄ‚ú®' }, { name: 'Verlassenes Forschungslabor', emoji: 'üß™üèöÔ∏è' },
                { name: 'Planetendschungel (Alien)', emoji: 'üå¥üëΩ' }, { name: 'Schwebende Stadt', emoji: '‚òÅÔ∏èüèôÔ∏è' }, { name: 'Datenarchiv (Galaxy)', emoji: 'üíæüåå' },
                { name: 'Energiequelle (Stern)', emoji: '‚òÄÔ∏è‚ö°' }, { name: 'Mechanische Welt', emoji: '‚öôÔ∏èü™ê' }, { name: 'Mutanten-Versteck', emoji: 'üß¨‚ò£Ô∏è' },
                { name: 'Nanobot-Schwarm', emoji: 'ü¶†‚öôÔ∏è' }, { name: 'Orbitale Werft', emoji: 'üõ∞Ô∏èüèóÔ∏è' }, { name: 'Plasma-Mine', emoji: 'üî•‚õèÔ∏è' },
                { name: 'Quantencomputer-Kern', emoji: 'üíªüí°' }, { name: 'Roboterkampf-Arena', emoji: 'ü§ñ‚öîÔ∏è' }, { name: 'Schiffswrack im All', emoji: 'üöÄüíî' },
                { name: 'Sensor-Phalanx', emoji: 'üì°üëÅÔ∏è' }, { name: 'Simulatorraum', emoji: 'üïπÔ∏èüíª' }, { name: 'Sph√§renbau (Dyson-Sph√§re)', emoji: '‚òÄÔ∏è‚öôÔ∏è' },
                { name: 'Sternenzerst√∂rer-Br√ºcke', emoji: 'üí•üöÄ' }, { name: 'Tarnfeld-Generatorstation', emoji: 'üõ°Ô∏è‚öôÔ∏è' }, { name: 'Teleportationskammer', emoji: 'üí´üö™' },
                { name: 'Tr√ºmmerfeld eines Kampfes', emoji: 'üí•‚òÑÔ∏è' }, { name: 'Verlassene Erdbasis', emoji: 'üåçüèöÔ∏è' }, { name: 'Waffenfabrik (futuristisch)', emoji: 'üî´üè≠' },
                { name: 'Xeno-Arch√§ologische St√§tte', emoji: 'ü¶¥üëΩ' }, { name: 'Asteroiden-Bergbau-Station', emoji: '‚òÑÔ∏è‚õèÔ∏è' }, { name: 'Biogenetisches Labor', emoji: 'üß¨üß™' },
                { name: 'Cyberpunk-Megacity', emoji: 'üåÉü§ñ' }, { name: 'Energie-Schild-Kontrollraum', emoji: 'üõ°Ô∏èüíª' }, { name: 'Fliegendes Auto Rennen', emoji: 'üèéÔ∏è‚òÅÔ∏è' },
                { name: 'Hologramm-Theater', emoji: 'üé≠üí°' }, { name: 'Kryo-Schlafkammer', emoji: 'ü•∂üõå' }, { name: 'Laser-Gef√§ngnis', emoji: 'üö®‚õìÔ∏è' },
                { name: 'Magnetbahn-Station', emoji: 'üöÜ‚ö°' }
            ]},
            'historisch': { name: 'Historische Orte', locations: [
                { name: 'Ritterburg', emoji: 'üè∞' }, { name: 'Piratenschiff', emoji: 'üè¥‚Äç‚ò†Ô∏è' }, { name: 'Wildwest-Saloon', emoji: 'ü§†üçª' },
                { name: '√Ñgyptische Pyramide', emoji: ' –ø–∏—Ä–∞–º–∏–¥–∞ ? -> üèúÔ∏è' }, { name: 'R√∂misches Kolosseum', emoji: 'üèõÔ∏è‚öîÔ∏è' }, { name: 'Wikingerdorf', emoji: 'üõñü™ì' },
                { name: 'Mittelalterlicher Markt', emoji: 'üè∞üõí' }, { name: 'Dinosaurier-Dschungel (Zeit)', emoji: 'ü¶ñüå¥' }, { name: 'Maya-Tempel', emoji: 'üèõÔ∏è‚òÄÔ∏è' },
                { name: 'Steinzeit-H√∂hle', emoji: 'ü¶¥üèûÔ∏è' }, { name: 'Griechische Agora', emoji: 'üèõÔ∏èüó£Ô∏è' }, { name: 'Samurai-Dojo', emoji: 'üèØ‚öîÔ∏è' },
                { name: 'Kloster (Mittelalter)', emoji: '‚õ™Ô∏èüôè' }, { name: 'Azteken-Stadt', emoji: 'üèõÔ∏èüêç' }, { name: 'Inka-Bergfestung', emoji: '‚õ∞Ô∏èüèõÔ∏è' },
                { name: 'Napoleonisches Schlachtfeld', emoji: '‚öîÔ∏èüá´üá∑' }, { name: 'London (Viktorianisch)', emoji: 'üé©üíÇ' }, { name: 'Goldrausch-Mine', emoji: '‚õèÔ∏èüí∞' },
                { name: 'Gladiatorenschule', emoji: '‚öîÔ∏èüèüÔ∏è' }, { name: '√Ñgyptischer Tempel', emoji: 'üèõÔ∏è‚òÄÔ∏è' }, { name: 'Akropolis', emoji: 'üèõÔ∏èüá¨üá∑' },
                { name: 'Berliner Mauer (Checkpoint)', emoji: 'üß±üöß' }, { name: 'Burgverlies', emoji: 'üè∞‚õìÔ∏è' }, { name: 'Chinesische Mauer', emoji: 'üß±üá®üá≥' },
                { name: 'Druidenkreis', emoji: 'üå≥‚≠ï' }, { name: 'Eisenbahnbaustelle (19. Jh.)', emoji: 'üöÇüèóÔ∏è' }, { name: 'Forum Romanum', emoji: 'üèõÔ∏èüáÆüáπ' },
                { name: 'Gallisches Dorf', emoji: 'üõñüõ°Ô∏è' }, { name: 'Geheime Speakeasy Bar (Prohibition)', emoji: 'üç∏ü§´' }, { name: 'Handelsposten (Seidenstra√üe)', emoji: 'üê´üåè' },
                { name: 'Highland-Spiele', emoji: 'üèÖüè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø' }, { name: 'Hof von Versailles', emoji: '‚öúÔ∏èüè∞' }, { name: 'Indianer-Reservat', emoji: 'üõñüèπ' },
                { name: 'Inquisitionskammer', emoji: '‚öñÔ∏èüî•' }, { name: 'Karawanserei', emoji: 'üê´üõñ' }, { name: 'Lenin Mausoleum', emoji: 'üèõÔ∏èüá∑üá∫' },
                { name: 'Maya Ballspielplatz', emoji: '‚öΩÔ∏èüèõÔ∏è' }, { name: 'Mount Rushmore (Bau)', emoji: 'üóøüèóÔ∏è' }, { name: 'Oktoberfest (Historisch)', emoji: 'üçªü•®' },
                { name: 'Olympische Spiele (Antik)', emoji: 'üèÖüèõÔ∏è' }, { name: 'Pharaonengrab', emoji: 'üëëüè∫' }, { name: 'Prager Burg', emoji: 'üè∞üá®üáø' },
                { name: 'Renaissance-Messe', emoji: 'üé®üé≠' }, { name: 'R√∂misches Bad', emoji: 'üõÄüèõÔ∏è' }, { name: 'Schottische Highland-Schlacht', emoji: '‚öîÔ∏èüè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø' },
                { name: 'Sch√ºtzengraben (1. WK)', emoji: 'üí£ü§ï' }, { name: 'Sovietischer Gulag', emoji: 'ü•∂‚õìÔ∏è' }, { name: 'Spartanisches Trainingslager', emoji: 'üõ°Ô∏èüí™' },
                { name: 'Speicherstadt Hamburg (1900)', emoji: '‚öìÔ∏èüß±' }, { name: 'Taj Mahal (Bau)', emoji: 'üïåüáÆüá≥' }, { name: 'Templerfestung', emoji: '‚úùÔ∏èüè∞' },
                { name: 'Titanic (an Bord)', emoji: 'üö¢üßä' }
            ]},
            'alltag': { name: 'Alltagsorte', locations: [
                { name: 'Bibliothek', emoji: 'üìö' }, { name: 'Park', emoji: 'üå≥' }, { name: 'Fitnessstudio', emoji: 'üí™' }, { name: 'B√ºrogeb√§ude', emoji: 'üè¢' },
                { name: 'Baustelle', emoji: 'üèóÔ∏è' }, { name: 'Bauernhof', emoji: 'üßë‚Äçüåæ' }, { name: 'Museum', emoji: 'üèõÔ∏è' }, { name: 'U-Bahn Station', emoji: 'üöá' },
                { name: 'Flughafen', emoji: '‚úàÔ∏è' }, { name: 'Caf√©', emoji: '‚òï' }, { name: 'Wohnung', emoji: 'üè†' }, { name: 'Werkstatt', emoji: 'üõ†Ô∏è' },
                { name: 'Supermarkt', emoji: 'üõí' }, { name: 'Restaurant', emoji: 'üçΩÔ∏è' }, { name: 'Schule', emoji: 'üè´' }, { name: 'Krankenhaus', emoji: 'üè•' },
                { name: 'Hotel', emoji: 'üè®' }, { name: 'Bank', emoji: 'üè¶' }, { name: 'Polizeistation', emoji: 'üöì' }, { name: 'Theater', emoji: 'üé≠' },
                { name: 'Kino', emoji: 'üé¨' }, { name: 'Buchhandlung', emoji: 'üìñ' }, { name: 'Friseursalon', emoji: 'üíá‚Äç‚ôÄÔ∏è' }, { name: 'Tierarztpraxis', emoji: 'üêï‚Äç‚öïÔ∏è' },
                { name: 'Schwimmbad', emoji: 'üèä‚Äç‚ôÄÔ∏è' }, { name: 'Rathaus', emoji: 'üèõÔ∏è' }, { name: 'Gerichtsgeb√§ude', emoji: '‚öñÔ∏è' }, { name: 'Universit√§t', emoji: 'üéì' },
                { name: 'Kirche', emoji: '‚õ™' }, { name: 'Moschee', emoji: 'üïå' }, { name: 'Synagoge', emoji: 'üïç' }, { name: 'Tempel', emoji: '‚õ©Ô∏è' }, // Generic temple
                { name: 'Fu√üballstadion', emoji: '‚öΩ' }, { name: 'Konzertsaal', emoji: 'üé∂' }, { name: 'Wochenmarkt', emoji: 'üçé' }, { name: 'Waschsalon', emoji: 'üß∫' },
                { name: 'Autowerkstatt', emoji: 'üöóüõ†Ô∏è' }, { name: 'Fahrschule', emoji: 'üöóüö¶' }, { name: 'G√§rtnerei', emoji: 'üå±' }, { name: 'Heimwerkermarkt', emoji: 'üî®' },
                { name: 'Jugendzentrum', emoji: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶' }, { name: 'Kindergarten', emoji: 'üß∏' }, { name: 'Musikschule', emoji: 'üéµ' }, { name: 'Optiker', emoji: 'üëì' },
                { name: 'Pflegeheim', emoji: 'üëµ' }, { name: 'Reiseb√ºro', emoji: '‚úàÔ∏èüó∫Ô∏è' }, { name: 'Schuhgesch√§ft', emoji: 'üëü' }, { name: 'Spielplatz', emoji: 'ü§∏‚Äç‚ôÄÔ∏è' },
                { name: 'Tankstelle', emoji: '‚õΩ' }, { name: 'Wartezimmer (Arzt)', emoji: '‚è≥üë®‚Äç‚öïÔ∏è' }
            ]},
            'urlaub': { name: 'Urlaubsorte', locations: [
                { name: 'Kreuzfahrtschiff', emoji: 'üõ≥Ô∏è' }, { name: 'Skih√ºtte', emoji: '‚õ∑Ô∏èüè†' }, { name: 'Tropeninsel', emoji: 'üå¥üèùÔ∏è' }, { name: 'Wohnmobil', emoji: 'üöê' },
                { name: 'Zeltplatz', emoji: 'üèïÔ∏è' }, { name: 'Bergh√ºtte', emoji: '‚õ∞Ô∏èüè†' }, { name: 'Safari-Lodge', emoji: 'ü¶íüõñ' }, { name: 'Vergn√ºgungspark', emoji: 'üé¢' },
                { name: 'Wellness-Resort', emoji: 'üßñ‚Äç‚ôÄÔ∏èüè®' }, { name: 'Strandbar', emoji: 'üçπüèñÔ∏è' }, { name: 'Korallenriff (Tauchen)', emoji: 'üê†üåä' }, { name: 'Hausboot', emoji: 'üõ∂üè†' },
                { name: 'Jugendherberge', emoji: 'üßë‚Äçü§ù‚Äçüßëüè®' }, { name: 'Luxushotel', emoji: 'üè®‚ú®' }, { name: 'Motel an der Autobahn', emoji: 'üöóüè®' }, { name: 'Nationalpark (Wandern)', emoji: 'üèûÔ∏èüö∂‚Äç‚ôÄÔ∏è' },
                { name: 'Weinregion (Verkostung)', emoji: 'üçáüç∑' }, { name: 'Surfschule', emoji: 'üèÑ‚Äç‚ôÄÔ∏èüè´' }, { name: 'Backpacker-Hostel', emoji: 'üéíüè®' }, { name: 'Bungalow am See', emoji: 'üè°üèûÔ∏è' },
                { name: 'Camping am Fluss', emoji: 'üèïÔ∏èüèûÔ∏è' }, { name: 'Casino-Resort', emoji: 'üé∞üè®' }, { name: 'Eis-Hotel', emoji: '‚ùÑÔ∏èüè®' }, { name: 'Ferienwohnung am Meer', emoji: 'üèñÔ∏èüè†' },
                { name: 'Flughafen Lounge', emoji: '‚úàÔ∏èüõãÔ∏è' }, { name: 'Freizeitbad mit Rutschen', emoji: 'üåäüé¢' }, { name: 'Golfplatz', emoji: '‚õ≥üèåÔ∏è‚Äç‚ôÄÔ∏è' }, { name: 'Historische Altstadt (Tour)', emoji: 'üè∞üö∂‚Äç‚ôÇÔ∏è' },
                { name: 'Inselhopping (F√§hre)', emoji: '‚õ¥Ô∏èüèùÔ∏è' }, { name: 'Kajak-Tour', emoji: 'üõ∂üèûÔ∏è' }, { name: 'Kletterpark', emoji: 'üå≥üßó‚Äç‚ôÄÔ∏è' }, { name: 'Leuchtturm-√úbernachtung', emoji: 'üí°üõå' },
                { name: 'Marktplatz (Souvenirs)', emoji: 'üéÅüõí' }, { name: 'Mietwagen-Station', emoji: 'üöóüîë' }, { name: 'Museumsbesuch (St√§dtereise)', emoji: 'üèõÔ∏èüñºÔ∏è' }, { name: 'Poolbereich (Hotel)', emoji: 'üèä‚Äç‚ôÇÔ∏èüè®' },
                { name: 'Reiterhof', emoji: 'üêéüßë‚Äçüåæ' }, { name: 'Riad in Marokko', emoji: 'üïåüá≤üá¶' }, { name: 'Roadtrip (Route 66)', emoji: 'üöóüõ£Ô∏è' }, { name: 'Segelboot', emoji: '‚õµüåä' },
                { name: 'Sommerrodelbahn', emoji: 'üõ∑‚òÄÔ∏è' }, { name: 'Staudamm (Besichtigung)', emoji: 'ÎåêüèûÔ∏è' }, { name: 'Sternwarte (Nachtwanderung)', emoji: 'üî≠‚ú®' }, { name: 'Strandpromenade', emoji: 'üèñÔ∏èüö∂‚Äç‚ôÄÔ∏è' },
                { name: 'Thermalbad', emoji: '‚ô®Ô∏èüßñ‚Äç‚ôÇÔ∏è' }, { name: 'Trekking-Tour (Himalaya)', emoji: '‚õ∞Ô∏èüö∂‚Äç‚ôÇÔ∏è' }, { name: 'Unterwasser-Restaurant', emoji: 'üê†üçΩÔ∏è' }, { name: 'Vulkanwanderung', emoji: 'üåãüö∂‚Äç‚ôÄÔ∏è' },
                { name: 'Wasserskianlage', emoji: 'üèÑ‚Äç‚ôÇÔ∏èüåä' }, { name: 'Weihnachtsmarkt', emoji: 'üéÑüéÅ' }, { name: 'Yoga-Retreat', emoji: 'üßò‚Äç‚ôÄÔ∏èüïâÔ∏è' }
            ]}
        };

        // --- DOM Elements --- (Same)
        const setupScreen = document.getElementById('setupScreen');
        const assignmentScreen = document.getElementById('assignmentScreen');
        const completeScreen = document.getElementById('completeScreen');
        const playerCountInput = document.getElementById('playerCountInput');
        const decrementPlayerBtn = document.getElementById('decrementPlayer');
        const incrementPlayerBtn = document.getElementById('incrementPlayer');
        const playerCountError = document.getElementById('playerCountError');
        const spyCountInput = document.getElementById('spyCountInput');
        const decrementSpyBtn = document.getElementById('decrementSpy');
        const incrementSpyBtn = document.getElementById('incrementSpy');
        const spyCountError = document.getElementById('spyCountError');
        const locationPacksContainer = document.getElementById('locationPacksContainer');
        const selectAllPacksBtn = document.getElementById('selectAllPacks');
        const deselectAllPacksBtn = document.getElementById('deselectAllPacks');
        const packSelectionError = document.getElementById('packSelectionError');
        const startGameButton = document.getElementById('startGameButton');
        const readyPlayerState = document.getElementById('readyPlayerState');
        const readyPlayerHeading = document.getElementById('readyPlayerHeading');
        const readyPlayerNumber = document.getElementById('readyPlayerNumber');
        const showRoleButton = document.getElementById('showRoleButton');
        const showRoleState = document.getElementById('showRoleState');
        const rolePlayerHeading = document.getElementById('rolePlayerHeading');
        const roleEmoji = document.getElementById('roleEmoji'); // Get the new span
        const roleText = document.getElementById('roleText');
        const hideRoleButton = document.getElementById('hideRoleButton');
        // const locationImage = document.getElementById('locationImage'); // No longer needed
        const handoverIconContainer = document.getElementById('handoverIconContainer');
        const roleIconContainer = document.getElementById('roleIconContainer');
        const newGameButton = document.getElementById('newGameButton');


        // --- Game State Variables --- (Same)
        let playerCount = 3;
        let spyCount = 1;
        let selectedPackKeys = new Set();
        let allSelectedLocations = []; // Will hold { name, emoji } objects
        let gameLocation = null;
        let spyIndices = new Set();
        let playerRoles = [];
        let currentPlayerIndex = 0;

        // --- Functions ---

        // ** UPDATED Pre-process Location Data **
        // Ensures each location has an emoji (or default)
        function preprocessLocationData() {
             const defaultEmoji = '‚ùì';
             Object.keys(locationData).forEach(key => {
                const pack = locationData[key];
                if (Array.isArray(pack.locations)) {
                     pack.locations = pack.locations.map(loc => {
                        // If it's somehow still a string
                        if (typeof loc === 'string') {
                            return { name: loc, emoji: defaultEmoji };
                        }
                        // Ensure emoji exists, add default if not
                        return { ...loc, emoji: loc.emoji || defaultEmoji };
                    });
                }
            });
        }

        // (Rest of functions are mostly identical to the previous working version)

         // Populate Location Pack Checkboxes
        function populateLocationPacks() {
            locationPacksContainer.innerHTML = '';
            Object.keys(locationData).forEach(key => {
                const pack = locationData[key]; const packId = `pack-${key}`; const div = document.createElement('div'); div.className = 'pack-option';
                const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.id = packId; checkbox.value = key; checkbox.addEventListener('change', handlePackSelection);
                const label = document.createElement('label'); label.htmlFor = packId; const count = Array.isArray(pack.locations) ? pack.locations.length : 0; label.textContent = `${pack.name} (${count} Orte)`;
                div.appendChild(checkbox); div.appendChild(label); locationPacksContainer.appendChild(div);
            });
            const checkboxes = locationPacksContainer.querySelectorAll('input[type="checkbox"]'); checkboxes.forEach(cb => { if (selectedPackKeys.has(cb.value)) cb.checked = true; });
        }
        function updatePlayerCount(change) {
            let currentVal = parseInt(playerCountInput.value) || 0; currentVal += change;
            if (currentVal >= 3) { playerCountInput.value = currentVal; const currentSpyCount = parseInt(spyCountInput.value); if (currentSpyCount >= currentVal) spyCountInput.value = Math.max(1, currentVal - 1); validateSetup(); }
            else { playerCountInput.value = 3; if (parseInt(spyCountInput.value) >= 3) spyCountInput.value = Math.max(1, 3 - 1); validateSetup(); }
        }
        function updateSpyCount(change) {
            let currentVal = parseInt(spyCountInput.value) || 0; currentVal += change; const currentPlayerCount = parseInt(playerCountInput.value) || 3;
            if (currentVal >= 1 && currentVal < currentPlayerCount) { spyCountInput.value = currentVal; validateSetup(); }
            else if (currentVal < 1) { spyCountInput.value = 1; validateSetup(); }
            else { spyCountInput.value = Math.max(1, currentPlayerCount - 1); validateSetup(); }
        }
        function handlePackSelection() { selectedPackKeys.clear(); const checkboxes = locationPacksContainer.querySelectorAll('input[type="checkbox"]:checked'); checkboxes.forEach(cb => selectedPackKeys.add(cb.value)); validateSetup(); }
        function toggleAllPacks(select) { const checkboxes = locationPacksContainer.querySelectorAll('input[type="checkbox"]'); checkboxes.forEach(cb => cb.checked = select); handlePackSelection(); }
        function validateSetup() {
            let isPlayerCountValid = false, isSpyCountValid = false, arePacksSelected = false; const pCount = parseInt(playerCountInput.value); const sCount = parseInt(spyCountInput.value);
            if (isNaN(pCount) || pCount < 3) { playerCountError.textContent = 'Mindestens 3 Spieler ben√∂tigt.'; playerCountError.classList.add('visible'); isPlayerCountValid = false; } else { playerCountError.textContent = ''; playerCountError.classList.remove('visible'); playerCount = pCount; isPlayerCountValid = true; }
            if (isNaN(sCount) || sCount < 1) { spyCountError.textContent = 'Mindestens 1 Spion ben√∂tigt.'; spyCountError.classList.add('visible'); isSpyCountValid = false; } else if (isPlayerCountValid && sCount >= pCount) { spyCountError.textContent = 'Weniger Spione als Spieler ben√∂tigt.'; spyCountError.classList.add('visible'); isSpyCountValid = false; } else { spyCountError.textContent = ''; spyCountError.classList.remove('visible'); if (!isNaN(sCount)) spyCount = sCount; isSpyCountValid = true; }
            arePacksSelected = selectedPackKeys.size > 0; if (!arePacksSelected) { packSelectionError.textContent = 'Mindestens ein Orte-Paket ausw√§hlen.'; packSelectionError.classList.add('visible'); } else { packSelectionError.textContent = ''; packSelectionError.classList.remove('visible'); }
            startGameButton.disabled = !(isPlayerCountValid && isSpyCountValid && arePacksSelected);
        }
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } }
        function setupGame() {
            allSelectedLocations = []; selectedPackKeys.forEach(key => { if (locationData[key]?.locations) allSelectedLocations.push(...locationData[key].locations); else console.error(`Pack data missing/invalid: ${key}`); });
            if (allSelectedLocations.length === 0) { packSelectionError.textContent = 'Keine Orte in Paketen gefunden.'; packSelectionError.classList.add('visible'); return; }
            gameLocation = allSelectedLocations[Math.floor(Math.random() * allSelectedLocations.length)]; spyIndices.clear(); let playerIndices = Array.from({ length: playerCount }, (_, i) => i + 1); shuffleArray(playerIndices);
            for (let i = 0; i < spyCount; i++) spyIndices.add(playerIndices[i]); playerRoles = []; for (let i = 1; i <= playerCount; i++) playerRoles.push(spyIndices.has(i) ? 'Spy' : gameLocation);
            currentPlayerIndex = 1; showScreen('assignmentScreen'); displayReadyScreen();
        }
        function showScreen(screenId) { document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active')); document.getElementById(screenId).classList.add('active'); }
        function displayReadyScreen() { readyPlayerHeading.textContent = `Bereit f√ºr Spieler ${currentPlayerIndex}?`; readyPlayerNumber.textContent = `Spieler ${currentPlayerIndex}`; showRoleState.classList.add('hidden'); readyPlayerState.classList.remove('hidden'); }

        // ** UPDATED Display Role Screen (Uses Emoji) **
        function displayRoleScreen() {
            const role = playerRoles[currentPlayerIndex - 1];
            rolePlayerHeading.textContent = `Rolle f√ºr Spieler ${currentPlayerIndex}`;

            if (role === 'Spy') {
                roleEmoji.textContent = 'üïµÔ∏è'; // Spy emoji
                roleText.innerHTML = `<span class="role-label">Du bist ein</span><strong>Spion!</strong>`;
            } else { // role is a location object { name, emoji }
                roleEmoji.textContent = role.emoji || '‚ùì'; // Location emoji or fallback
                roleText.innerHTML = `<span class="role-label">Du bist am Ort:</span><strong>${role.name || 'Unbekannt'}</strong>`;
            }

            hideRoleButton.textContent = (currentPlayerIndex === playerCount) ? 'Verstanden & Spiel beginnen!' : 'Verstanden & Weitergeben';
            readyPlayerState.classList.add('hidden');
            showRoleState.classList.remove('hidden');
        }

        function handleNextPlayer() { currentPlayerIndex++; if (currentPlayerIndex <= playerCount) displayReadyScreen(); else showScreen('completeScreen'); }
        function resetGame() { playerCountInput.value = 3; spyCountInput.value = 1; allSelectedLocations = []; gameLocation = null; spyIndices.clear(); playerRoles = []; currentPlayerIndex = 0; validateSetup(); showScreen('setupScreen'); }
        function loadIcons() { const handoverSVG = document.getElementById('handoverIconSVG').cloneNode(true); handoverSVG.removeAttribute('id'); handoverIconContainer.innerHTML = ''; handoverIconContainer.appendChild(handoverSVG); const roleSVG = document.getElementById('roleIconSVG').cloneNode(true); roleSVG.removeAttribute('id'); roleIconContainer.innerHTML = ''; roleIconContainer.appendChild(roleSVG); }

        // --- Event Listeners --- (Same)
        decrementPlayerBtn.addEventListener('click', () => updatePlayerCount(-1)); incrementPlayerBtn.addEventListener('click', () => updatePlayerCount(1)); playerCountInput.addEventListener('input', validateSetup);
        decrementSpyBtn.addEventListener('click', () => updateSpyCount(-1)); incrementSpyBtn.addEventListener('click', () => updateSpyCount(1)); spyCountInput.addEventListener('input', validateSetup);
        selectAllPacksBtn.addEventListener('click', () => toggleAllPacks(true)); deselectAllPacksBtn.addEventListener('click', () => toggleAllPacks(false));
        startGameButton.addEventListener('click', setupGame); showRoleButton.addEventListener('click', displayRoleScreen); hideRoleButton.addEventListener('click', handleNextPlayer); newGameButton.addEventListener('click', resetGame);

        // --- Initialisation ---
        document.addEventListener('DOMContentLoaded', () => {
            preprocessLocationData(); // Ensure emojis are set
            populateLocationPacks();
            loadIcons();
            validateSetup();
            showScreen('setupScreen');
        });

    </script>

</body>
</html>